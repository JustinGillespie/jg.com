// Generated by CoffeeScript 1.6.3
(function() {
  var isMobile, loadProjectControls, setupStages, switchProjectControls, switchStage;

  switchStage = function(current, stages, direction) {
    var h, i, w;
    i = current.index();
    h = $(window).height();
    w = $(window).width();
    if (direction === 'down' && i !== stages.length) {
      current.next().css({
        marginTop: h * current.index()
      });
      current.css({
        height: h,
        width: w,
        marginTop: 0,
        position: 'fixed',
        left: 0,
        top: 0
      });
    }
    if (direction === 'up' && i !== stages.length) {
      current.next().css({
        marginTop: 0
      });
      return current.css({
        position: 'relative',
        marginTop: h * (current.index() - 1)
      });
    }
  };

  setupStages = function(stages, header) {
    var h, w;
    w = $(window).width();
    h = !isMobile() ? $(window).height() : 'auto';
    stages.waypoint('destroy');
    stages.css({
      height: h,
      width: w,
      position: 'relative',
      margin: '0'
    });
    if (!isMobile()) {
      $("html").animate({
        scrollTop: 0
      }, 1);
      $("body").animate({
        scrollTop: 0
      }, 1);
      stages.waypoint(function(dir) {
        return switchStage($(this), stages, dir);
      });
      return stages.last().waypoint((function(dir) {
        var color;
        color = (dir === 'down' ? '#666666' : '#FFFFFF');
        return header.find('*').animate({
          color: color
        });
      }), {
        offset: 30
      });
    }
  };

  switchProjectControls = function(args) {
    var controls;
    controls = $('#project-controls');
    return controls.find('a').removeClass('active').eq(args.currentSlideNumber - 1).addClass('active');
  };

  loadProjectControls = function(args) {
    var controls, i, link;
    controls = $('<div id="project-controls" class="project-controls"></div>');
    i = 1;
    while (i <= args.data.slideNodes.length) {
      link = $('<a href="#"></a>');
      if (i === 1) {
        link.addClass('active');
      }
      link.appendTo(controls);
      i++;
    }
    controls.on('click', function(e) {
      if (e.target.nodeName.toLowerCase() === 'a') {
        args.sliderContainerObject.iosSlider('goToSlide', $(e.target).index() + 1);
      }
      return e.preventDefault();
    });
    return args.sliderContainerObject.parent().append(controls);
  };

  isMobile = function() {
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      return true;
    } else {
      return false;
    }
  };

  $(document).ready(function() {
    var header, projects, services, services_links, stages;
    header = $("header");
    stages = $("section");
    stages.css({
      display: 'table',
      height: '100%',
      position: 'relative',
      width: '100%'
    });
    projects = {
      container: $('#projects'),
      prev: $("#prev-project"),
      next: $("#next-project"),
      controls: $("#project-controls")
    };
    projects.container.iosSlider({
      desktopClickDrag: true,
      snapToChildren: true,
      keyboardControls: true,
      infiniteSlider: true,
      navPrevSelector: projects.prev,
      navNextSelector: projects.next,
      onSlideChange: switchProjectControls,
      onSliderLoaded: loadProjectControls
    });
    services = $('div[data-service-id]');
    services_links = $('a[data-service]');
    services.not('.active').hide();
    services_links.on('click', function(e) {
      var current, id;
      id = $(this).data('service');
      current = $('div[data-service-id="' + id + '"]');
      services_links.removeClass('active');
      $(this).addClass('active');
      services.hide();
      current.show();
      return e.preventDefault();
    });
    $(window).resize(function(e) {
      return setupStages(stages, header);
    }).resize();
    return $('a[data-link]').on('click', function(e) {
      var endpoint, i, target;
      target = $(this).data('link');
      i = $('section.' + target).index() - 1;
      endpoint = $(window).width() > 700 ? $(window).height() * i : $('.create').position().top;
      $('html').animate({
        scrollTop: endpoint
      }, 1100);
      $('body').animate({
        scrollTop: endpoint
      }, 1100);
      return e.preventDefault();
    });
  });

}).call(this);
